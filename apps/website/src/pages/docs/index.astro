---
import { getCollection } from 'astro:content';
import '../../styles/global.css';

// Get the main docs index
const allDocs = await getCollection('docs');
const indexDoc = allDocs.find(doc => doc.slug === 'index');

if (!indexDoc) {
  // If no index doc, redirect to quickstart
  return Astro.redirect('/docs/getting-started/quickstart');
}

const { Content } = await indexDoc.render();

// Group docs by section
const sections = [
  {
    title: 'Getting Started',
    items: allDocs.filter(d => d.slug.startsWith('getting-started/')).sort((a, b) => {
      const order = ['quickstart', 'installation', 'first-project'];
      const aIndex = order.findIndex(o => a.slug.includes(o));
      const bIndex = order.findIndex(o => b.slug.includes(o));
      return aIndex - bIndex;
    })
  },
  {
    title: 'AI Integration',
    items: allDocs.filter(d => d.slug.startsWith('ai/'))
  },
  {
    title: 'Core Features',
    items: allDocs.filter(d => d.slug.startsWith('core/'))
  },
  {
    title: 'CLI Reference',
    items: allDocs.filter(d => d.slug.startsWith('cli/'))
  },
  {
    title: 'Configuration',
    items: allDocs.filter(d => d.slug.startsWith('config/'))
  },
  {
    title: 'Frameworks',
    items: allDocs.filter(d => d.slug.startsWith('frameworks/'))
  },
  {
    title: 'Advanced',
    items: allDocs.filter(d => d.slug.startsWith('advanced/'))
  }
].filter(section => section.items.length > 0);
---

<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <title>SolForge Documentation</title>
    <meta name="description" content="Complete documentation for SolForge - AI-powered Solana development suite" />
  </head>
  <body class="min-h-screen bg-background text-foreground antialiased">
    <!-- Top Navigation -->
    <nav class="border-b border-border">
      <div class="container mx-auto px-4 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-2">
            <a href="/" class="text-2xl font-bold">âš¡ SolForge</a>
          </div>
          <div class="flex items-center gap-6">
            <a href="/docs" class="text-sm hover:text-primary transition-colors">Docs</a>
            <a href="https://github.com/nitishxyz/solforge" target="_blank" class="text-sm hover:text-primary transition-colors">GitHub</a>
          </div>
        </div>
      </div>
    </nav>

    <div class="container flex max-w-screen-2xl px-6 py-8 md:grid md:grid-cols-[240px_1fr] md:gap-8 lg:grid-cols-[280px_1fr] lg:gap-12">
      <!-- Sidebar -->
      <aside class="hidden md:block md:sticky md:top-20 md:h-[calc(100vh-5rem)] md:overflow-y-auto md:pr-4">
        <nav class="space-y-6">
          {sections.map((section) => (
            <div>
              <h4 class="mb-2 text-sm font-semibold">
                {section.title}
              </h4>
              <div class="space-y-1">
                {section.items.map((item) => (
                  <a
                    href={`/docs/${item.slug}`}
                    class="block text-sm text-muted-foreground transition-colors hover:text-foreground py-1"
                  >
                    {item.data.title}
                  </a>
                ))}
              </div>
            </div>
          ))}
        </nav>
      </aside>

      <!-- Main Content -->
      <main class="min-w-0 flex-1">
        <div class="mx-auto w-full min-w-0 max-w-4xl">
          <div class="mt-8">
            <article class="prose prose-lg dark:prose-invert max-w-none prose-headings:font-bold prose-h1:text-5xl prose-h1:mb-4 prose-h2:text-3xl prose-h2:mt-12 prose-h2:mb-4 prose-h3:text-2xl prose-h3:mt-8 prose-h3:mb-3 prose-p:text-lg prose-p:leading-relaxed prose-li:text-lg prose-code:text-base prose-pre:text-sm prose-a:text-primary prose-a:no-underline hover:prose-a:underline">
              <Content />
            </article>
          </div>
        </div>
      </main>
    </div>
  </body>
</html>
